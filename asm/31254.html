<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Back to Skool: Routine at 31254</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../skool.css" />
<link rel="stylesheet" type="text/css" href="../bts.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="31252.html">31252</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#31254">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="31462.html">31462</a></span></td>
</tr>
</table>
<div class="description">31254: Control a mouse</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
The address of this uninterruptible subcommand routine is placed into bytes 17 and 18 of a mouse's buffer by the routine at <a class="link" href="31502.html">31502</a> (if the mouse was released by ERIC) or by the routine at <a class="link" href="62910.html">62910</a> (when preparing for a new game). Bytes 16 and 19-22 of the mouse's buffer are used to store the following values that control its movement:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th>Byte</th>
<th>Contents</th>
</tr>
<tr>
<td class="centre">16</td>
<td>Counter decremented each time the mouse hides (if the mouse was released by ERIC); when it reaches 0, the mouse dies (returns control to the character whose buffer it borrowed)</td>
</tr>
<tr>
<td class="centre">19</td>
<td>Direction of travel, and the distance remaining to travel before hiding or considering a change of direction: it is positive (bit 7 reset) if the mouse is travelling right, and decremented on each pass; it is negative (bit 7 set) if the mouse is travelling left, and incremented on each pass; while the mouse is hiding, it is 0</td>
</tr>
<tr>
<td class="centre">20</td>
<td>Counter decremented on each change of direction or distance to travel; when it reaches 0, the mouse hides</td>
</tr>
<tr>
<td class="centre">21</td>
<td>Counter determining how much longer the mouse has left to hide</td>
</tr>
<tr>
<td class="centre">22</td>
<td>x-coordinate of the mouse when it last hid</td>
</tr>
</table>
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Mouse's character number (198, 199, 206-208, 212)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31254"></a>31254</td>
<td class="instruction">LD L,19</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=remaining distance to travel</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31256"></a>31256</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31257"></a>31257</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is this mouse (a) hiding, (b) about to hide, or (c) about to consider a change of direction and distance to travel?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31258"></a>31258</td>
<td class="instruction">JR Z,31330</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31260"></a>31260</td>
<td class="instruction">LD A,(32756)</td>
<td class="comment-11" rowspan="1"><a class="link" href="32756.html">32756</a> holds the door/window status flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31263"></a>31263</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">Save these flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31264"></a>31264</td>
<td class="instruction">AND 63</td>
<td class="comment-11" rowspan="2">Reset bits 6 and 7 of the door/window status flags (i.e. pretend that the windows are closed)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31266"></a>31266</td>
<td class="instruction">LD (32756),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31269"></a>31269</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Set the zero flag if the mouse is travelling right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31271"></a>31271</td>
<td class="instruction">LD L,1</td>
<td class="comment-11" rowspan="2">Collect the mouse's x-coordinate in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31273"></a>31273</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31274"></a>31274</td>
<td class="instruction">JR Z,31278</td>
<td class="comment-11" rowspan="1">Jump if the mouse is travelling right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31276"></a>31276</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31277"></a>31277</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31278"></a>31278</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=x-coordinate of the spot in front of the mouse</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31279"></a>31279</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31280"></a>31280</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=mouse's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31281"></a>31281</td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="1">Copy this to <span class="register">D</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31282"></a>31282</td>
<td class="instruction">CP 10</td>
<td class="comment-11" rowspan="1">Is the mouse on the middle floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31284"></a>31284</td>
<td class="instruction">JR NZ,31291</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31286"></a>31286</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x-coordinate of the spot in front of the mouse</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31287"></a>31287</td>
<td class="instruction">CP 84</td>
<td class="comment-11" rowspan="1">Is the mouse at the top of the stairs leading down to the stage?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31289"></a>31289</td>
<td class="instruction">JR Z,31296</td>
<td class="comment-11" rowspan="1">Turn the mouse round if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31291"></a>31291</td>
<td class="instruction">CALL <a class="link" href="30292.html">30292</a></td>
<td class="comment-11" rowspan="1">Check for walls and closed doors in the mouse's path</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31294"></a>31294</td>
<td class="instruction">JR NC,31304</td>
<td class="comment-11" rowspan="1">Jump if there are none</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31296"></a>31296</td>
<td class="instruction">LD L,19</td>
<td class="comment-11" rowspan="4">Turn the mouse round without changing the distance remaining to travel</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31298"></a>31298</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31299"></a>31299</td>
<td class="instruction">NEG</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31301"></a>31301</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31302"></a>31302</td>
<td class="instruction">JR 31269</td>
<td class="comment-11" rowspan="1">See what's in front of the mouse in this direction</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31304"></a>
<div class="comments">
<div class="paragraph">
There are no walls or closed doors in the mouse's path.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31304"></a>31304</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="2">Restore the door/window status flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31305"></a>31305</td>
<td class="instruction">LD (32756),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31308"></a>31308</td>
<td class="instruction">CALL <a class="link" href="25012.html">25012</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the mouse's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31311"></a>31311</td>
<td class="instruction">LD L,19</td>
<td class="comment-11" rowspan="2">Is the mouse travelling right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31313"></a>31313</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31315"></a>31315</td>
<td class="instruction">JR Z,31323</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31317"></a>31317</td>
<td class="instruction">INC (HL)</td>
<td class="comment-11" rowspan="1">Decrease the distance left to travel</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31318"></a>31318</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="1">Move the mouse one space left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31319"></a>31319</td>
<td class="instruction">LD A,47</td>
<td class="comment-11" rowspan="1"><a class="link" href="../graphics/as.html#47">47</a>: animatory state of a mouse travelling left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31321"></a>31321</td>
<td class="instruction">JR 31327</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31323"></a>31323</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Decrease the distance left to travel</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31324"></a>31324</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1">Move the mouse one space right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31325"></a>31325</td>
<td class="instruction">LD A,175</td>
<td class="comment-11" rowspan="1"><a class="link" href="../graphics/as.html#175">175</a>: animatory state of a mouse travelling right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31327"></a>31327</td>
<td class="instruction">JP <a class="link" href="24880.html">24880</a></td>
<td class="comment-11" rowspan="1">Update the mouse's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31330"></a>
<div class="comments">
<div class="paragraph">
Byte 19 holds 0, which means (a) the mouse is hiding at the moment, or (b) it's time for the mouse to consider a change of direction and distance to travel, or (c) it's time to hide for a bit.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31330"></a>31330</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">Pick up byte 20 in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31331"></a>31331</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31332"></a>31332</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is the mouse already hiding?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31333"></a>31333</td>
<td class="instruction">JR Z,31372</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31335"></a>31335</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Is it time for the mouse to hide temporarily?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31336"></a>31336</td>
<td class="instruction">JR NZ,31347</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31338"></a>31338</td>
<td class="instruction">LD L,1</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 1 of the mouse's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31340"></a>31340</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=mouse's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31341"></a>31341</td>
<td class="instruction">LD L,22</td>
<td class="comment-11" rowspan="2">Store this in byte 22 of the mouse's buffer for later retrieval</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31343"></a>31343</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31344"></a>31344</td>
<td class="instruction">JP <a class="link" href="29896.html#29907">29907</a></td>
<td class="comment-11" rowspan="1">Make the mouse hide</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31347"></a>
<div class="comments">
<div class="paragraph">
It's time for the mouse to consider a change of direction and distance to travel.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31347"></a>31347</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31348"></a>31348</td>
<td class="instruction">CALL <a class="link" href="31150.html">31150</a></td>
<td class="comment-11" rowspan="1">Make any girls near this mouse start jumping</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31351"></a>31351</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31352"></a>31352</td>
<td class="instruction">CALL <a class="link" href="25233.html">25233</a></td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31355"></a>31355</td>
<td class="instruction">AND 131</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=2-5 (bit 7 reset) or 130-133 (bit 7 set)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31357"></a>31357</td>
<td class="instruction">ADD A,2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31359"></a>31359</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="3"><span class="register">A</span>=2-5 (bit 7 reset), with the carry flag holding the previous contents of bit 7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31360"></a>31360</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31361"></a>31361</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31362"></a>31362</td>
<td class="instruction">JR C,31366</td>
<td class="comment-11" rowspan="1">Jump if bit 7 was set (the new direction is right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31364"></a>31364</td>
<td class="instruction">NEG</td>
<td class="comment-11" rowspan="1">The new direction is left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31366"></a>31366</td>
<td class="instruction">LD L,19</td>
<td class="comment-11" rowspan="2">Set the new direction and distance to travel</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31368"></a>31368</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31369"></a>31369</td>
<td class="instruction">JP 31260</td>
<td class="comment-11" rowspan="1">Start moving</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31372"></a>
<div class="comments">
<div class="paragraph">
The mouse is currently hiding. Check whether it should transform into a frog before reappearing (in case ERIC obtained the Science Lab storeroom key in the meantime).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31372"></a>31372</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=21</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31373"></a>31373</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Is it time for the mouse to come out of hiding?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31374"></a>31374</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31375"></a>31375</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=mouse's character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31376"></a>31376</td>
<td class="instruction">CP 212</td>
<td class="comment-11" rowspan="1">Was this mouse released by ERIC?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31378"></a>31378</td>
<td class="instruction">JR NZ,31424</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31380"></a>31380</td>
<td class="instruction">LD A,(32747)</td>
<td class="comment-11" rowspan="1"><a class="link" href="32747.html">32747</a> holds the inventory flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31383"></a>31383</td>
<td class="instruction">BIT 1,A</td>
<td class="comment-11" rowspan="1">Has ERIC got the Science Lab storeroom key?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31385"></a>31385</td>
<td class="instruction">JR Z,31398</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31387"></a>31387</td>
<td class="instruction">LD A,29</td>
<td class="comment-11" rowspan="1"><a class="link" href="../graphics/as.html#29">29</a>: animatory state of the frog</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31389"></a>31389</td>
<td class="instruction">LD DE,2619</td>
<td class="comment-11" rowspan="1">(<span class="register">E</span>,<span class="register">D</span>)=(59,10) (location where the frog enters the game)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31392"></a>31392</td>
<td class="instruction">CALL <a class="link" href="24880.html">24880</a></td>
<td class="comment-11" rowspan="1">Update the frog's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31395"></a>31395</td>
<td class="instruction">JP <a class="link" href="30906.html#31061">31061</a></td>
<td class="comment-11" rowspan="1">Bring the frog into the game</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31398"></a>
<div class="comments">
<div class="paragraph">
It's time for this mouse to come out of hiding.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31398"></a>31398</td>
<td class="instruction">CALL <a class="link" href="25233.html">25233</a></td>
<td class="comment-11" rowspan="3"><span class="register">A</span>=random number between 5 and 20; this determines how long the mouse will hide next time</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31401"></a>31401</td>
<td class="instruction">AND 15</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31403"></a>31403</td>
<td class="instruction">ADD A,5</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31405"></a>31405</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Store this in byte 21 of the mouse's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31406"></a>31406</td>
<td class="instruction">CALL <a class="link" href="25233.html">25233</a></td>
<td class="comment-11" rowspan="3"><span class="register">A</span>=random number between 2 and 5; this determines how many changes of direction and distance to travel the mouse will make before hiding again</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31409"></a>31409</td>
<td class="instruction">AND 3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31411"></a>31411</td>
<td class="instruction">ADD A,2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31413"></a>31413</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="2">Store this in byte 20 of the mouse's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31414"></a>31414</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31415"></a>31415</td>
<td class="instruction">LD L,22</td>
<td class="comment-11" rowspan="2"><span class="register">E</span>=x-coordinate of the mouse before it hid</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31417"></a>31417</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31418"></a>31418</td>
<td class="instruction">LD L,2</td>
<td class="comment-11" rowspan="2"><span class="register">D</span>=y-coordinate of the mouse</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31420"></a>31420</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31421"></a>31421</td>
<td class="instruction">JP 31325</td>
<td class="comment-11" rowspan="1">Unhide the mouse</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31424"></a>
<div class="comments">
<div class="paragraph">
This mouse was released by ERIC and is currently hiding. It's due to come out of hiding, or die.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31424"></a>31424</td>
<td class="instruction">LD L,16</td>
<td class="comment-11" rowspan="1">Byte 16 holds the mouse's lifespan counter</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31426"></a>31426</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Is it time for this mouse to disappear for ever?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31427"></a>31427</td>
<td class="instruction">JR NZ,31451</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31429"></a>
<div class="comments">
<div class="paragraph">
This mouse must die, and return control of the buffer it hijacked (198, 199, 206-208) to its original owner (little boy no. 9 or 10, BOY WANDER, ANGELFACE or EINSTEIN).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31429"></a>31429</td>
<td class="instruction">LD L,29</td>
<td class="comment-11" rowspan="2">Set bits 0 and 7 at byte 29: restart the command list and make the character run</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31431"></a>31431</td>
<td class="instruction">LD (HL),129</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31433"></a>31433</td>
<td class="instruction">LD L,10</td>
<td class="comment-11" rowspan="2">Remove any interruptible subcommand routine address that may have been in the character's buffer before it was hijacked</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31435"></a>31435</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31437"></a>31437</td>
<td class="instruction">LD L,15</td>
<td class="comment-11" rowspan="2">Pick up from byte 15 the animatory state of the character whose buffer the mouse borrowed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31439"></a>31439</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31440"></a>31440</td>
<td class="instruction">AND 240</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's base animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31442"></a>31442</td>
<td class="instruction">LD L,0</td>
<td class="comment-11" rowspan="2">Restore this character's animatory state to its base value</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31444"></a>31444</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31445"></a>31445</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">Make the character reappear at x-coordinate 32 (which should be off-screen because ERIC cannot release mice in the boys' skool)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31446"></a>31446</td>
<td class="instruction">LD (HL),32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31448"></a>31448</td>
<td class="instruction">JP <a class="link" href="25484.html#25492">25492</a></td>
<td class="comment-11" rowspan="1">Terminate this uninterruptible subcommand, thus returning control to the character who normally owns the buffer</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31451"></a>
<div class="comments">
<div class="paragraph">
This mouse (released by ERIC) is about to come out of hiding.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31451"></a>31451</td>
<td class="instruction">LD A,(32767)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=leftmost column of the play area on screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31454"></a>31454</td>
<td class="instruction">CP 144</td>
<td class="comment-11" rowspan="1">Is at least half of the girls' skool on-screen?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31456"></a>31456</td>
<td class="instruction">JR C,31429</td>
<td class="comment-11" rowspan="1">Terminate the mouse if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31458"></a>31458</td>
<td class="instruction">LD L,21</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31460"></a>31460</td>
<td class="instruction">JR 31398</td>
<td class="comment-11" rowspan="1">Otherwise make the mouse reappear</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="31252.html">31252</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#31254">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="31462.html">31462</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Back to Skool RAM disassembly 20140614</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>