<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Back to Skool: Routine at 28085</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../bts.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="28067.html">28067</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#28085">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="28114.html">28114</a></span></td>
</tr>
</table>
<div class="description">28085: Determine which floor ERIC's on when he's not standing directly on one</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Continues from the routine at <a class="link" href="25534.html">25534</a>, having determined that ERIC's feet are not on the floor. On entry, the zero flag is set if (a) ERIC is jumping and the zero flag was set (by chance) upon entering the routine at <a class="link" href="25534.html">25534</a>, or (b) bits 1 and 2 of ERIC's status flags at <a class="link" href="32749.html">32749</a> are both reset. Returns with <span class="register">D</span>=17 if the zero flag is set upon entry (regardless of which floor ERIC is on, which is a <a class="link" href="../reference/bugs.html#jumpAbsent">bug</a>); otherwise returns with <span class="register">D</span>=3, 10, 14 or 17, indicating which floor ERIC is directly above.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">D</td>
<td class="register-desc">ERIC's y-coordinate</td>
</tr>
<tr>
<td class="register">E</td>
<td class="register-desc">ERIC's x-coordinate</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28085"></a>28085</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ERIC's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28086"></a>28086</td>
<td class="instruction">LD D,17</td>
<td class="comment-11" rowspan="1">17=bottom floor</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28088"></a>28088</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return with <span class="register">D</span>=17 if the zero flag was set upon entry (regardless of which floor ERIC is on, which is a <a class="link" href="../reference/bugs.html#jumpAbsent">bug</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28089"></a>28089</td>
<td class="instruction">LD D,3</td>
<td class="comment-11" rowspan="1">3=top floor</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28091"></a>28091</td>
<td class="instruction">CP 4</td>
<td class="comment-11" rowspan="1">Is ERIC directly above the top floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28093"></a>28093</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return with <span class="register">D</span>=3 if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28094"></a>28094</td>
<td class="instruction">LD D,10</td>
<td class="comment-11" rowspan="1">10=middle floor</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28096"></a>28096</td>
<td class="instruction">CP 11</td>
<td class="comment-11" rowspan="1">Is ERIC directly above the middle floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28098"></a>28098</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return with <span class="register">D</span>=10 if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28099"></a>28099</td>
<td class="instruction">LD D,17</td>
<td class="comment-11" rowspan="1">17=bottom floor</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28101"></a>28101</td>
<td class="instruction">CP 15</td>
<td class="comment-11" rowspan="1">Is ERIC below the height of the stage?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28103"></a>28103</td>
<td class="instruction">RET NC</td>
<td class="comment-11" rowspan="1">Return with <span class="register">D</span>=17 if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28104"></a>28104</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ERIC's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28105"></a>28105</td>
<td class="instruction">CP 76</td>
<td class="comment-11" rowspan="4">Return with <span class="register">D</span>=17 if ERIC is not directly above the assembly hall stage</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28107"></a>28107</td>
<td class="instruction">RET C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28108"></a>28108</td>
<td class="instruction">CP 82</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28110"></a>28110</td>
<td class="instruction">RET NC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28111"></a>28111</td>
<td class="instruction">LD D,14</td>
<td class="comment-11" rowspan="1">14=assembly hall stage</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28113"></a>28113</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="28067.html">28067</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#28085">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="28114.html">28114</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Back to Skool RAM disassembly 20150415</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>