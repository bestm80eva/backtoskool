<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Back to Skool: Routine at 21152</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../skool.css" />
<link rel="stylesheet" type="text/css" href="../bts.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="20956.html">20956</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#21152">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="21237.html">21237</a></span></td>
</tr>
</table>
<div class="description">21152: Display the cast of characters and change their names</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="21664.html">21664</a>. For each member of the cast: displays his name and title, walks him onto the screen, allows the user to change the name, and then walks him off the screen.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="21152"></a>21152</td>
<td class="instruction">LD A,21</td>
<td class="comment-11" rowspan="1">Message <a class="link" href="61267.html">21</a>: 'MR WACKER'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="21154"></a>21154</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">Save the message number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21155"></a>21155</td>
<td class="instruction">ADD A,80</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=101-111 (message number for the character's title)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21157"></a>21157</td>
<td class="instruction">LD HL,16512</td>
<td class="comment-11" rowspan="1">16512=display file address</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21160"></a>21160</td>
<td class="instruction">CALL <a class="link" href="20665.html#20668">20668</a></td>
<td class="comment-11" rowspan="1">Print the appropriate title (e.g. 'THE HEADMASTER')</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21163"></a>21163</td>
<td class="instruction">LD A,244</td>
<td class="comment-11" rowspan="1">Message <a class="link" href="22000.html">244</a>: '' (empty string)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21165"></a>21165</td>
<td class="instruction">CALL <a class="link" href="20665.html">20665</a></td>
<td class="comment-11" rowspan="1">Print this (thus removing 'Press 'C' to change name' from the screen)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21168"></a>21168</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1">Restore the message number for the character's name to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21169"></a>21169</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">Save it again</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21170"></a>21170</td>
<td class="instruction">LD HL,20544</td>
<td class="comment-11" rowspan="1">20544=display file address</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21173"></a>21173</td>
<td class="instruction">CALL <a class="link" href="20665.html#20668">20668</a></td>
<td class="comment-11" rowspan="1">Print the character's name there</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21176"></a>21176</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1">Restore the message number for the character's name to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21177"></a>21177</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">Save it again</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21178"></a>21178</td>
<td class="instruction">ADD A,224</td>
<td class="comment-11" rowspan="3">Point <span class="register">HL</span> at an entry in the table of animatory states at <a class="link" href="21237.html">21237</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21180"></a>21180</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21181"></a>21181</td>
<td class="instruction">LD H,82</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21183"></a>21183</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=animatory state of the character standing, facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21184"></a>21184</td>
<td class="instruction">LD HL,53760</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of ERIC's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21187"></a>21187</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Fill in the animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21188"></a>21188</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21189"></a>21189</td>
<td class="instruction">LD (HL),124</td>
<td class="comment-11" rowspan="1">Fill in the character's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21191"></a>21191</td>
<td class="instruction">CALL <a class="link" href="20956.html">20956</a></td>
<td class="comment-11" rowspan="1">Walk the character to the middle of the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="21194"></a>21194</td>
<td class="instruction">LD HL,23611</td>
<td class="comment-11" rowspan="2">Reset bit 5 at 23611, ready for any future keypress</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21197"></a>21197</td>
<td class="instruction">RES 5,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21199"></a>21199</td>
<td class="instruction">LD A,250</td>
<td class="comment-11" rowspan="1">Message <a class="link" href="22235.html">250</a>: 'Press 'C' to change name'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21201"></a>21201</td>
<td class="instruction">CALL <a class="link" href="20665.html">20665</a></td>
<td class="comment-11" rowspan="1">Print this message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="21204"></a>21204</td>
<td class="instruction">CALL <a class="link" href="29118.html#29154">29154</a></td>
<td class="comment-11" rowspan="2">Wait for a keypress</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21207"></a>21207</td>
<td class="instruction">JR Z,21204</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21209"></a>21209</td>
<td class="instruction">OR 32</td>
<td class="comment-11" rowspan="1">Convert the keypress to lower case</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21211"></a>21211</td>
<td class="instruction">CP 99</td>
<td class="comment-11" rowspan="1">Was 'c' pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21213"></a>21213</td>
<td class="instruction">JR NZ,21227</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="21215"></a>
<div class="comments">
<div class="paragraph">
The user pressed 'c' to change the character's name.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21215"></a>21215</td>
<td class="instruction">LD A,252</td>
<td class="comment-11" rowspan="1">Message <a class="link" href="22000.html">252</a>: 'Enter new name'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21217"></a>21217</td>
<td class="instruction">CALL <a class="link" href="20665.html">20665</a></td>
<td class="comment-11" rowspan="1">Print this message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21220"></a>21220</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1">Restore the message number for the character's name to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21221"></a>21221</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">Save it again</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21222"></a>21222</td>
<td class="instruction">CALL <a class="link" href="20896.html">20896</a></td>
<td class="comment-11" rowspan="1">Change the character's name</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21225"></a>21225</td>
<td class="instruction">JR 21194</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="21227"></a>
<div class="comments">
<div class="paragraph">
The user pressed some key other than 'c'.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="21227"></a>21227</td>
<td class="instruction">CALL <a class="link" href="20956.html">20956</a></td>
<td class="comment-11" rowspan="1">Walk the character off screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21230"></a>21230</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1">Restore the message number for the character's name to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21231"></a>21231</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">Next character</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21232"></a>21232</td>
<td class="instruction">CP 32</td>
<td class="comment-11" rowspan="1">Have we done all the main game characters yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21234"></a>21234</td>
<td class="instruction">JR NZ,21154</td>
<td class="comment-11" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="21236"></a>21236</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="20956.html">20956</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#21152">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="21237.html">21237</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Back to Skool RAM disassembly 20140614</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>