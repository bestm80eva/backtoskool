<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Back to Skool: Routine at 31861</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../skool.css" />
<link rel="stylesheet" type="text/css" href="../bts.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="31844.html">31844</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#31861">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="31887.html">31887</a></span></td>
</tr>
</table>
<div class="description">31861: Collect the bit mask and game status buffer address for an event identifier</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="31887.html">31887</a>, and also by the unused routines at <a class="link" href="31893.html">31893</a> and <a class="link" href="31905.html">31905</a>. The event identifier in <span class="register">A</span> (0, 7-12), taken modulo 8, corresponds to a bit in one of the bytes at <a class="link" href="32640.html">32640</a> (<span class="register">A</span>&lt;=7) or <a class="link" href="32641.html">32641</a> (<span class="register">A</span>&gt;=8). On exit, <span class="register">HL</span> points to the appropriate byte and <span class="register">A</span> holds the bit mask (single bit set), as follows:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th>Entry</th>
<th>Exit</th>
<th>Event</th>
</tr>
<tr>
<td class="centre">0</td>
<td class="centre">1</td>
<td>End of lesson</td>
</tr>
<tr>
<td class="centre">7</td>
<td class="centre">128</td>
<td>Time to sit down for assembly</td>
</tr>
<tr>
<td class="centre">8</td>
<td class="centre">1</td>
<td>Teacher has arrived at the top-floor room in the girls' skool</td>
</tr>
<tr>
<td class="centre">9</td>
<td class="centre">2</td>
<td>Teacher has arrived at the middle-floor room in the girls' skool</td>
</tr>
<tr>
<td class="centre">10</td>
<td class="centre">4</td>
<td>Teacher has arrived at the Blue Room</td>
</tr>
<tr>
<td class="centre">11</td>
<td class="centre">8</td>
<td>Teacher has arrived at the Yellow Room</td>
</tr>
<tr>
<td class="centre">12</td>
<td class="centre">16</td>
<td>Teacher has arrived at the Science Lab</td>
</tr>
</table>
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Event ID from a command list</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31861"></a>31861</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="2">Set the carry flag if the event identifier is odd</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31862"></a>31862</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31863"></a>31863</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">Copy bits 1-3 of the event ID into bits 0-2 of <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31864"></a>31864</td>
<td class="instruction">LD A,0</td>
<td class="comment-11" rowspan="3"><span class="register">A</span>=1 if the event ID is an even number, 2 if it's an odd number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31866"></a>31866</td>
<td class="instruction">ADC A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31867"></a>31867</td>
<td class="instruction">INC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31868"></a>31868</td>
<td class="instruction">RR E</td>
<td class="comment-11" rowspan="1">Now bits 2 and 3 of the event ID are in bits 0 and 1 of <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31870"></a>31870</td>
<td class="instruction">JR NC,31874</td>
<td class="comment-11" rowspan="1">Jump if the event ID is 0, 8, 9 or 12 (bit 1 reset)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31872"></a>31872</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=4 (event ID = 10) or 8 (event ID = 7 or 11)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31873"></a>31873</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31874"></a>31874</td>
<td class="instruction">SCF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31875"></a>31875</td>
<td class="instruction">RR E</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=128 (event ID &lt;= 7) or 129</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31877"></a>31877</td>
<td class="instruction">JR NC,31883</td>
<td class="comment-11" rowspan="1">Jump if the event ID is 0, 8, 9, 10 or 11 (bit 2 reset)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31879"></a>31879</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="4"><span class="register">A</span>=16 (event ID = 12) or 128 (event ID = 7)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31880"></a>31880</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31881"></a>31881</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31882"></a>31882</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31883"></a>31883</td>
<td class="instruction">LD D,127</td>
<td class="comment-11" rowspan="2"><span class="register">HL</span>=<a class="link" href="32640.html">32640</a> or <a class="link" href="32641.html">32641</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31885"></a>31885</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31886"></a>31886</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="31844.html">31844</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#31861">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="31887.html">31887</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Back to Skool RAM disassembly 20140614</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>