<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Back to Skool: Routine at 29716</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../bts.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="29696.html">29696</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#29716">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="29834.html">29834</a></span></td>
</tr>
</table>
<div class="description">29716: Make a teacher give lines</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a class="link" href="30102.html">30102</a>, <a class="link" href="32062.html">32062</a> and <a class="link" href="61487.html">61487</a>. Prints the lines message (e.g. '100 LINES ERIC') in a message box above the teacher's head, and shortly afterwards prints the reprimand message (e.g. 'NO CATAPULTS') in the same box.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Lines recipient's character number (206-210)</td>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Reprimand message number</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Teacher's character number (200-204)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29716"></a>29716</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">Save the lines recipient's character number briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29717"></a>29717</td>
<td class="instruction">CALL <a class="link" href="29696.html">29696</a></td>
<td class="comment-11" rowspan="1">Collect in <span class="register">DE</span> the coordinates of the teacher's head</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29720"></a>29720</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1">Restore the lines recipient's character number to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29721"></a>29721</td>
<td class="instruction">ADD A,77</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=<a class="link" href="61345.html">27</a>, <a class="link" href="61358.html">28</a>, <a class="link" href="61371.html">29</a>, <a class="link" href="61384.html">30</a> or <a class="link" href="61397.html">31</a> (message number for the lines recipient's name)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29723"></a>29723</td>
<td class="instruction">LD (32650),A</td>
<td class="comment-11" rowspan="1">Place it into <a class="link" href="32650.html">32650</a> (the first byte of message <a class="link" href="32650.html">5</a>, which is used as a submessage of message <a class="link" href="59886.html">13</a>: '[12]0 LINES^[5]')</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29726"></a>29726</td>
<td class="instruction">SUB 22</td>
<td class="comment-11" rowspan="6">Compute the attribute byte to be used for the lines message: 15 (blue background) for BOY WANDER; 23 (red background) for ANGELFACE or EINSTEIN; 31 (magenta background) for HAYLEY or ERIC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29728"></a>29728</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29729"></a>29729</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29730"></a>29730</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29731"></a>29731</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29732"></a>29732</td>
<td class="instruction">DEC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29733"></a>29733</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">Copy the lines message attribute byte to <span class="register">C</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29734"></a>29734</td>
<td class="instruction">NOP</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29735"></a>29735</td>
<td class="instruction">NOP</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29736"></a>29736</td>
<td class="instruction">NOP</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29737"></a>29737</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29738"></a>29738</td>
<td class="instruction">CALL <a class="link" href="27276.html">27276</a></td>
<td class="comment-11" rowspan="1">Save the area of screen that will be overwritten by the lines message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29741"></a>29741</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29742"></a>29742</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if the teacher giving lines is off-screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29743"></a>29743</td>
<td class="instruction">CALL <a class="link" href="25233.html">25233</a></td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29746"></a>29746</td>
<td class="instruction">AND 14</td>
<td class="comment-11" rowspan="7">Set <span class="register">L</span>=10, 20, 30, 40, 50, 60, 70 or 80 (number of lines/10)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29748"></a>29748</td>
<td class="instruction">ADD A,2</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29750"></a>29750</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29751"></a>29751</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29752"></a>29752</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29753"></a>29753</td>
<td class="instruction">ADD A,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29754"></a>29754</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29755"></a>29755</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=attribute byte for the lines message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29756"></a>29756</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29757"></a>29757</td>
<td class="instruction">CP 15</td>
<td class="comment-11" rowspan="1">Is the teacher giving lines to BOY WANDER?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29759"></a>29759</td>
<td class="instruction">JR Z,29774</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29761"></a>29761</td>
<td class="instruction">CP 31</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29763"></a>29763</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=number of lines/10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29764"></a>29764</td>
<td class="instruction">JR Z,29771</td>
<td class="comment-11" rowspan="1">Jump if the teacher is giving lines to ERIC or HAYLEY</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29766"></a>29766</td>
<td class="instruction">CALL <a class="link" href="29621.html">29621</a></td>
<td class="comment-11" rowspan="2">Add EINSTEIN's or ANGELFACE's lines to the score and print the score</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29769"></a>29769</td>
<td class="instruction">JR 29774</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29771"></a>29771</td>
<td class="instruction">CALL <a class="link" href="29643.html">29643</a></td>
<td class="comment-11" rowspan="1">Add lines and print the new lines total</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29774"></a>29774</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29775"></a>29775</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29776"></a>29776</td>
<td class="instruction">LD D,0</td>
<td class="comment-11" rowspan="1"><span class="register">DE</span>=number of lines/10</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29778"></a>29778</td>
<td class="instruction">CALL <a class="link" href="27572.html">27572</a></td>
<td class="comment-11" rowspan="1">Generate the ASCII codes for the decimal digits of the number in <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29781"></a>29781</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">Restore the attribute file address for the top left corner of the lines message box to <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29782"></a>29782</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore the lines reprimand number to <span class="register">B</span>. and the attribute byte for the lines message to <span class="register">C</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29783"></a>29783</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Save them again</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29784"></a>29784</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29785"></a>29785</td>
<td class="instruction">LD A,13</td>
<td class="comment-11" rowspan="1">Message <a class="link" href="59886.html">13</a>: '[12]0 LINES^[5]'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29787"></a>29787</td>
<td class="instruction">CALL <a class="link" href="27462.html">27462</a></td>
<td class="comment-11" rowspan="1">Print the lines message</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="29790"></a>
<div class="comments">
<div class="paragraph">
The lines message (e.g. '100 LINES ERIC') has been printed. Now for the accompanying sound effect.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29790"></a>29790</td>
<td class="instruction">LD A,(58408)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=attribute byte for the lines message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29793"></a>29793</td>
<td class="instruction">LD DE,10240</td>
<td class="comment-11" rowspan="1">Set the duration parameter for the beep</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29796"></a>29796</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="4">The border colour for the beep will be the same as the PAPER colour of the lines message box</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29797"></a>29797</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29798"></a>29798</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29799"></a>29799</td>
<td class="instruction">AND 7</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29801"></a>29801</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29802"></a>29802</td>
<td class="instruction">LD BC,5136</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=20 (pitch), <span class="register">C</span>=16 (no alternating colours)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29805"></a>29805</td>
<td class="instruction">CALL <a class="link" href="29836.html">29836</a></td>
<td class="comment-11" rowspan="1">Beep</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29808"></a>29808</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=PAPER colour of the lines message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29809"></a>29809</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">Restore the attribute file address for the top left corner of the lines message box to <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29810"></a>29810</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore the lines reprimand number to <span class="register">B</span>. and the attribute byte for the lines message to <span class="register">C</span></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="29811"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a class="link" href="29896.html">29896</a> (with <span class="register">A</span>=6, <span class="register">B</span>=<a class="link" href="59897.html">14</a>, <span class="register">C</span>=70) and <a class="link" href="62668.html">62668</a> (with <span class="register">A</span>=2, <span class="register">B</span>=<a class="link" href="60937.html">98</a>, <span class="register">C</span>=50).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29811"></a>29811</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29812"></a>29812</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29813"></a>29813</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=<a class="link" href="59897.html">14</a>, <a class="link" href="60937.html">98</a>, or a reprimand message number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29814"></a>29814</td>
<td class="instruction">CALL <a class="link" href="27462.html">27462</a></td>
<td class="comment-11" rowspan="1">Print the message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29817"></a>29817</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=border colour to use during the beep</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29818"></a>29818</td>
<td class="instruction">LD DE,5120</td>
<td class="comment-11" rowspan="1">Set the duration parameter for the beep</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29821"></a>29821</td>
<td class="instruction">LD BC,12816</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=50 (pitch), <span class="register">C</span>=16 (no alternating colours)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29824"></a>29824</td>
<td class="instruction">CALL <a class="link" href="29836.html">29836</a></td>
<td class="comment-11" rowspan="1">Beep</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29827"></a>29827</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">Restore the attribute file address for the top left corner of the message box to <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29828"></a>29828</td>
<td class="instruction">LD HL,58152</td>
<td class="comment-11" rowspan="1">The part of the screen overwritten by the message box was stored in the buffer at <a class="link" href="58152.html">58152</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29831"></a>29831</td>
<td class="instruction">JP <a class="link" href="27364.html">27364</a></td>
<td class="comment-11" rowspan="1">Restore the area of the screen overwritten by the message box</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="29696.html">29696</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#29716">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="29834.html">29834</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Back to Skool RAM disassembly 20150415</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>