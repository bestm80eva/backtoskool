<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Back to Skool: Routine at 25815</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../skool.css" />
<link rel="stylesheet" type="text/css" href="../bts.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="25812.html">25812</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#25815">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="25843.html">25843</a></span></td>
</tr>
</table>
<div class="description">25815: Make a character go to a random location</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by command lists <a class="link" href="53820.html">18</a>, <a class="link" href="57942.html">20</a>, <a class="link" href="57956.html">28</a>, <a class="link" href="59151.html">40</a>, <a class="link" href="58828.html">42</a>, <a class="link" href="59673.html">66</a>, <a class="link" href="59677.html">68</a>, <a class="link" href="59765.html">78</a> and <a class="link" href="58862.html">88</a> to make a character go to a place at random. The random locations are arranged in eight groups of four. The group of locations that is suitable for a particular character to choose from is determined by byte 36 of the character's buffer.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (183-209)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25815"></a>25815</td>
<td class="instruction">LD L,36</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 36 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25817"></a>25817</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the contents in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25818"></a>25818</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25819"></a>25819</td>
<td class="instruction">CALL <a class="link" href="25233.html">25233</a></td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=random number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25822"></a>25822</td>
<td class="instruction">AND 3</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=211, 212, 213 or 214</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25824"></a>25824</td>
<td class="instruction">ADD A,211</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25826"></a>25826</td>
<td class="instruction">LD H,A</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at an entry in the table of random locations</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25827"></a>25827</td>
<td class="instruction">LD E,1</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at byte 1 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25829"></a>25829</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25830"></a>25830</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is the character already at this x-coordinate?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25831"></a>25831</td>
<td class="instruction">JR Z,25819</td>
<td class="comment-11" rowspan="1">Get another random location if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25833"></a>25833</td>
<td class="instruction">LD E,5</td>
<td class="comment-11" rowspan="3">Copy the random location's coordinates into bytes 5 and 6 of the character's buffer, thus making it his next destination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25835"></a>25835</td>
<td class="instruction">LDI</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25837"></a>25837</td>
<td class="instruction">LDI</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25839"></a>25839</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Transfer the character number back to <span class="register">H</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25840"></a>25840</td>
<td class="instruction">JP <a class="link" href="25700.html#25705">25705</a></td>
<td class="comment-11" rowspan="1">Send the character on his way</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">

<div class="comments">
<div class="paragraph">
The contents of byte 36 of each character's buffer are as follows:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th><span class="register">H</span></th>
<th>Character</th>
<th>Address</th>
<th>Byte</th>
</tr>
<tr>
<td class="centre">183</td>
<td>Little girl no. 1</td>
<td class="centre"><a class="link" href="46848.html#46884">46884</a></td>
<td class="centre">36</td>
</tr>
<tr>
<td class="centre">184</td>
<td>Little girl no. 2</td>
<td class="centre"><a class="link" href="47104.html#47140">47140</a></td>
<td class="centre">36</td>
</tr>
<tr>
<td class="centre">185</td>
<td>Little girl no. 3</td>
<td class="centre"><a class="link" href="47360.html#47396">47396</a></td>
<td class="centre">36</td>
</tr>
<tr>
<td class="centre">186</td>
<td>Little girl no. 4</td>
<td class="centre"><a class="link" href="47616.html#47652">47652</a></td>
<td class="centre">38</td>
</tr>
<tr>
<td class="centre">187</td>
<td>Little girl no. 5</td>
<td class="centre"><a class="link" href="47872.html#47908">47908</a></td>
<td class="centre">38</td>
</tr>
<tr>
<td class="centre">188</td>
<td>Little girl no. 6</td>
<td class="centre"><a class="link" href="48128.html#48164">48164</a></td>
<td class="centre">38</td>
</tr>
<tr>
<td class="centre">189</td>
<td>Little girl no. 7</td>
<td class="centre"><a class="link" href="48384.html#48420">48420</a></td>
<td class="centre">38</td>
</tr>
<tr>
<td class="centre">190</td>
<td>Little boy no. 1</td>
<td class="centre"><a class="link" href="48640.html#48676">48676</a></td>
<td class="centre">40</td>
</tr>
<tr>
<td class="centre">191</td>
<td>Little boy no. 2</td>
<td class="centre"><a class="link" href="48896.html#48932">48932</a></td>
<td class="centre">40</td>
</tr>
<tr>
<td class="centre">192</td>
<td>Little boy no. 3</td>
<td class="centre"><a class="link" href="49152.html#49188">49188</a></td>
<td class="centre">40</td>
</tr>
<tr>
<td class="centre">193</td>
<td>Little boy no. 4</td>
<td class="centre"><a class="link" href="49408.html#49444">49444</a></td>
<td class="centre">42</td>
</tr>
<tr>
<td class="centre">194</td>
<td>Little boy no. 5</td>
<td class="centre"><a class="link" href="49664.html#49700">49700</a></td>
<td class="centre">42</td>
</tr>
<tr>
<td class="centre">195</td>
<td>Little boy no. 6</td>
<td class="centre"><a class="link" href="49920.html#49956">49956</a></td>
<td class="centre">42</td>
</tr>
<tr>
<td class="centre">196</td>
<td>Little boy no. 7</td>
<td class="centre"><a class="link" href="50176.html#50212">50212</a></td>
<td class="centre">42</td>
</tr>
<tr>
<td class="centre">197</td>
<td>Little boy no. 8</td>
<td class="centre"><a class="link" href="50432.html#50468">50468</a></td>
<td class="centre">42</td>
</tr>
<tr>
<td class="centre">198</td>
<td>Little boy no. 9</td>
<td class="centre"><a class="link" href="50688.html#50724">50724</a></td>
<td class="centre">44</td>
</tr>
<tr>
<td class="centre">199</td>
<td>Little boy no. 10</td>
<td class="centre"><a class="link" href="50944.html#50980">50980</a></td>
<td class="centre">44</td>
</tr>
<tr>
<td class="centre">200</td>
<td>MR WACKER</td>
<td class="centre"><a class="link" href="51200.html#51236">51236</a></td>
<td class="centre">48</td>
</tr>
<tr>
<td class="centre">201</td>
<td>MR WITHIT</td>
<td class="centre"><a class="link" href="51456.html#51492">51492</a></td>
<td class="centre">48</td>
</tr>
<tr>
<td class="centre">202</td>
<td>MR ROCKITT</td>
<td class="centre"><a class="link" href="51712.html#51748">51748</a></td>
<td class="centre">68</td>
</tr>
<tr>
<td class="centre">203</td>
<td>MR CREAK</td>
<td class="centre"><a class="link" href="51968.html#52004">52004</a></td>
<td class="centre">68</td>
</tr>
<tr>
<td class="centre">204</td>
<td>MISS TAKE</td>
<td class="centre"><a class="link" href="52224.html#52260">52260</a></td>
<td class="centre">38</td>
</tr>
<tr>
<td class="centre">205</td>
<td>ALBERT</td>
<td class="centre"><a class="link" href="52480.html#52516">52516</a></td>
<td class="centre">44</td>
</tr>
<tr>
<td class="centre">206</td>
<td>BOY WANDER</td>
<td class="centre"><a class="link" href="52736.html#52772">52772</a></td>
<td class="centre">46</td>
</tr>
<tr>
<td class="centre">207</td>
<td>ANGELFACE</td>
<td class="centre"><a class="link" href="52992.html#53028">53028</a></td>
<td class="centre">46</td>
</tr>
<tr>
<td class="centre">208</td>
<td>EINSTEIN</td>
<td class="centre"><a class="link" href="53248.html#53284">53284</a></td>
<td class="centre">44</td>
</tr>
<tr>
<td class="centre">209</td>
<td>HAYLEY</td>
<td class="centre"><a class="link" href="53504.html#53540">53540</a></td>
<td class="centre">36</td>
</tr>
</table>
</div>
<div class="paragraph">
The eight groups of random locations used by this routine are:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th><span class="register">E</span></th>
<th><span class="register">D</span>=211</th>
<th><span class="register">D</span>=212</th>
<th><span class="register">D</span>=213</th>
<th><span class="register">D</span>=214</th>
</tr>
<tr>
<td>36</td>
<td>129,17</td>
<td>144,17</td>
<td>136,17</td>
<td>189,17</td>
</tr>
<tr>
<td>38</td>
<td>189,17</td>
<td>189,10</td>
<td>170,17</td>
<td>182,3</td>
</tr>
<tr>
<td>40</td>
<td>38,3</td>
<td>10,10</td>
<td>10,17</td>
<td>66,17</td>
</tr>
<tr>
<td>42</td>
<td>38,3</td>
<td>10,17</td>
<td>109,17</td>
<td>75,17</td>
</tr>
<tr>
<td>44</td>
<td>112,17</td>
<td>145,17</td>
<td>158,17</td>
<td>37,3</td>
</tr>
<tr>
<td>46</td>
<td>189,10</td>
<td>183,17</td>
<td>137,17</td>
<td>72,17</td>
</tr>
<tr>
<td>48</td>
<td>157,17</td>
<td>38,3</td>
<td>10,17</td>
<td>92,17</td>
</tr>
<tr>
<td>68</td>
<td>38,3</td>
<td>90,3</td>
<td>10,17</td>
<td>90,17</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="25812.html">25812</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#25815">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="25843.html">25843</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Back to Skool RAM disassembly 20140614</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>