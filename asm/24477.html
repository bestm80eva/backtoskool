<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Back to Skool: Routine at 24477</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../bts.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="24476.html">24476</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#24477">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="24560.html">24560</a></span></td>
</tr>
</table>
<div class="description">24477: Play a tune</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="62910.html">62910</a>. The main entry point is used to play the theme tune.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="24477"></a>24477</td>
<td class="instruction">LD HL,23611</td>
<td class="comment-11" rowspan="2">Reset bit 5 at 23611, clearing the record of any keypresses before the tune starts</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24480"></a>24480</td>
<td class="instruction">RES 5,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24482"></a>24482</td>
<td class="instruction">LD HL,56384</td>
<td class="comment-11" rowspan="1">The theme tune data starts at <a class="link" href="56385.html">56385</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="24485"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="23907.html">23907</a> with <span class="register">HL</span>=<a class="link" href="56364.html">56364</a>-1 (the up-a-year tune data starts at <a class="link" href="56364.html">56364</a>).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="24485"></a>24485</td>
<td class="instruction">DI</td>
<td class="comment-11" rowspan="1">Disable interrupts</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="24486"></a>24486</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the next tune datum</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24487"></a>24487</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick it up</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24488"></a>24488</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">Is it an end-of-section marker?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24489"></a>24489</td>
<td class="instruction">JR NZ,24496</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24491"></a>24491</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="5">Point <span class="register">HL</span> at the first datum in the next section</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24492"></a>24492</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24493"></a>24493</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24494"></a>24494</td>
<td class="instruction">LD H,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24495"></a>24495</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="24496"></a>24496</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=tune datum</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24497"></a>24497</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Have we reached the end of the tune?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24498"></a>24498</td>
<td class="instruction">JP Z,<a class="link" href="62094.html#62169">62169</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="24501"></a>
<div class="comments">
<div class="paragraph">
A non-zero tune datum has been found, meaning the tune is not finished yet.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24501"></a>24501</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Save the tune data table pointer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24502"></a>24502</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1">Set the carry flag if we should pause briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24503"></a>24503</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">Copy the right-rotated tune datum to <span class="register">B</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24504"></a>24504</td>
<td class="instruction">JR NC,24514</td>
<td class="comment-11" rowspan="1">Jump unless we should pause briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24506"></a>24506</td>
<td class="instruction">LD D,15</td>
<td class="comment-11" rowspan="5">Pause briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="24508"></a>24508</td>
<td class="instruction">DEC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24509"></a>24509</td>
<td class="instruction">JR NZ,24508</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24511"></a>24511</td>
<td class="instruction">DEC D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24512"></a>24512</td>
<td class="instruction">JR NZ,24508</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="24514"></a>24514</td>
<td class="instruction">AND 7</td>
<td class="comment-11" rowspan="1">0&lt;=<span class="register">A</span>&lt;=7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24516"></a>24516</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1"><span class="register">C</span>=border colour for this note</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24517"></a>24517</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="4">Point <span class="register">HL</span> at an entry in the note duration/pitch data table at <a class="link" href="24560.html">24560</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24518"></a>24518</td>
<td class="instruction">ADD A,240</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24520"></a>24520</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24521"></a>24521</td>
<td class="instruction">LD H,95</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24523"></a>24523</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=original tune datum rotated right one bit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24524"></a>24524</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="13">Obtain the note frequency parameter in <span class="register">E</span> and the note duration parameter in <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24525"></a>24525</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24526"></a>24526</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24527"></a>24527</td>
<td class="instruction">AND 15</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24529"></a>24529</td>
<td class="instruction">LD B,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24530"></a>24530</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24531"></a>24531</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24532"></a>24532</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24533"></a>24533</td>
<td class="instruction">LD HL,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="24536"></a>24536</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24537"></a>24537</td>
<td class="instruction">DJNZ 24536</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24539"></a>24539</td>
<td class="instruction">RES 0,L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24541"></a>24541</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="24542"></a>24542</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="11">Produce a note</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24543"></a>24543</td>
<td class="instruction">OUT (254),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24545"></a>24545</td>
<td class="instruction">XOR 16</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24547"></a>24547</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24548"></a>24548</td>
<td class="instruction">LD B,E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="24549"></a>24549</td>
<td class="instruction">DJNZ 24549</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24551"></a>24551</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24552"></a>24552</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24553"></a>24553</td>
<td class="instruction">LD A,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24554"></a>24554</td>
<td class="instruction">OR L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24555"></a>24555</td>
<td class="instruction">JR NZ,24542</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24557"></a>24557</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore the tune data table pointer to <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="24558"></a>24558</td>
<td class="instruction">JR 24486</td>
<td class="comment-11" rowspan="1">Pick up the next tune datum</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="24476.html">24476</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#24477">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="24560.html">24560</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Back to Skool RAM disassembly 20150415</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>