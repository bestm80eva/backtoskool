<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Back to Skool: Routine at 26752</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../bts.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="26750.html">26750</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#26752">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="26845.html">26845</a></span></td>
</tr>
</table>
<div class="description">26752: Make a character write on a blackboard</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
The address of this interruptible subcommand routine is placed into bytes 9 and 10 of the character's buffer by the routines at <a class="link" href="32497.html">32497</a> and <a class="link" href="61696.html">61696</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (201-204, 206)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="26752"></a>26752</td>
<td class="instruction">CALL <a class="link" href="26453.html">26453</a></td>
<td class="comment-11" rowspan="1">Collect information about the board</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26755"></a>26755</td>
<td class="instruction">INC B</td>
<td class="comment-11" rowspan="3">Point <span class="register">BC</span> at the second byte of the board's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26756"></a>26756</td>
<td class="instruction">LD C,B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26757"></a>26757</td>
<td class="instruction">LD B,127</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26759"></a>26759</td>
<td class="instruction">LD A,(BC)</td>
<td class="comment-11" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26760"></a>26760</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Has the board been written on already?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26761"></a>26761</td>
<td class="instruction">JP NZ,<a class="link" href="25484.html#25488">25488</a></td>
<td class="comment-11" rowspan="1">Terminate this interruptible subcommand if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26764"></a>26764</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26765"></a>26765</td>
<td class="instruction">LD (BC),A</td>
<td class="comment-11" rowspan="1">Signal: this character wrote on the board</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26766"></a>26766</td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="3">Point <span class="register">BC</span> at the first byte of the board's buffer (<a class="link" href="32596.html">32596</a>, <a class="link" href="32602.html">32602</a>, <a class="link" href="32608.html">32608</a>, <a class="link" href="32614.html">32614</a> or <a class="link" href="32620.html">32620</a>) and initialise the pixel column to 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26767"></a>26767</td>
<td class="instruction">LD A,1</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26769"></a>26769</td>
<td class="instruction">LD (BC),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26770"></a>26770</td>
<td class="instruction">LD L,16</td>
<td class="comment-11" rowspan="4">Make sure there are no (sub)submessage addresses lying around in bytes 13-16 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26772"></a>26772</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26774"></a>26774</td>
<td class="instruction">LD L,14</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26776"></a>26776</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26778"></a>26778</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's number (201-204, 206)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26779"></a>26779</td>
<td class="instruction">CP 206</td>
<td class="comment-11" rowspan="7">Set <span class="register">E</span> as follows: 32=MR WITHIT, 38=MR ROCKITT, 44=MR CREAK, 50=MISS TAKE, 56=BOY WANDER</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26781"></a>26781</td>
<td class="instruction">ADC A,59</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26783"></a>26783</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26784"></a>26784</td>
<td class="instruction">ADC A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26785"></a>26785</td>
<td class="instruction">ADD A,E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26786"></a>26786</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26787"></a>26787</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="26788"></a>26788</td>
<td class="instruction">CALL <a class="link" href="25233.html">25233</a></td>
<td class="comment-11" rowspan="4">Collect a random number between 0 and 5 in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26791"></a>26791</td>
<td class="instruction">AND 7</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26793"></a>26793</td>
<td class="instruction">CP 6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26795"></a>26795</td>
<td class="instruction">JR NC,26788</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26797"></a>26797</td>
<td class="instruction">ADD A,E</td>
<td class="comment-11" rowspan="2">Now <span class="register">E</span>=blackboard message number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26798"></a>26798</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26799"></a>26799</td>
<td class="instruction">LD D,254</td>
<td class="comment-11" rowspan="8">Pick up the address of the message and place it into bytes 11 and 12 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26801"></a>26801</td>
<td class="instruction">LD L,11</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26803"></a>26803</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26804"></a>26804</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26805"></a>26805</td>
<td class="instruction">INC D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26806"></a>26806</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26807"></a>26807</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26808"></a>26808</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26809"></a>26809</td>
<td class="instruction">LD L,9</td>
<td class="comment-11" rowspan="2">Replace the address of this routine in bytes 9 and 10 of the character's buffer with <a class="link" href="26752.html#26813">26813</a> (below)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26811"></a>26811</td>
<td class="instruction">LD (HL),189</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26813"></a>26813</td>
<td class="instruction">CALL <a class="link" href="26513.html">26513</a></td>
<td class="comment-11" rowspan="1">Write one letter on the board</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26816"></a>26816</td>
<td class="instruction">JR NZ,26829</td>
<td class="comment-11" rowspan="1">Jump unless the character has finished writing</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="26818"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="27904.html">27904</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="26818"></a>26818</td>
<td class="instruction">CALL <a class="link" href="25012.html">25012</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the character's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26821"></a>26821</td>
<td class="instruction">AND 248</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=base animatory state of the character (arm down)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26823"></a>26823</td>
<td class="instruction">CALL <a class="link" href="24880.html">24880</a></td>
<td class="comment-11" rowspan="1">Update the character's animatory state and update the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26826"></a>26826</td>
<td class="instruction">JP <a class="link" href="25484.html#25488">25488</a></td>
<td class="comment-11" rowspan="1">Terminate this interruptible subcommand</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="26829"></a>
<div class="comments">
<div class="paragraph">
The character hasn't finished writing yet. Figure out his next arm movement (up or down).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="26829"></a>26829</td>
<td class="instruction">CALL <a class="link" href="25012.html">25012</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the character's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26832"></a>26832</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="2">Set the carry flag if the character's arm is raised</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26833"></a>26833</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26834"></a>26834</td>
<td class="instruction">JR C,26841</td>
<td class="comment-11" rowspan="1">Jump if the character's arm is raised</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26836"></a>26836</td>
<td class="instruction">OR 7</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=animatory state of the character with his arm up</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="26838"></a>26838</td>
<td class="instruction">JP <a class="link" href="24880.html">24880</a></td>
<td class="comment-11" rowspan="1">Update the character's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="26841"></a>26841</td>
<td class="instruction">AND 248</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=base animatory state of character (arm down)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="26843"></a>26843</td>
<td class="instruction">JR 26838</td>
<td class="comment-11" rowspan="1">Jump back to update the SRB</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="26750.html">26750</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#26752">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="26845.html">26845</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Back to Skool RAM disassembly 20150415</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>