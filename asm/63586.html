<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Back to Skool: Routine at 63586</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../bts.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Back to Skool" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="63576.html">63576</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#63586">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="63743.html">63743</a></span></td>
</tr>
</table>
<div class="description">63586: Deal with a stinkbomb when dropped</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
The address of this routine is placed into <a class="link" href="32727.html">32727</a> by the routine at <a class="link" href="28992.html">28992</a> when ERIC drops a stinkbomb. It creates a stinkbomb cloud and deals with it until it has dissipated, which includes checking whether MR WACKER and a closed window are nearby, and making the former set off for the latter if so.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63586"></a>63586</td>
<td class="instruction">LD HL,32747</td>
<td class="comment-11" rowspan="1"><a class="link" href="32747.html">32747</a> holds the inventory flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63589"></a>63589</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick these up in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63590"></a>63590</td>
<td class="instruction">AND 224</td>
<td class="comment-11" rowspan="1">Keep only the stinkbomb bits (bits 5-7)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63592"></a>63592</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="1">Shift these bits left, losing the leftmost bit</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63593"></a>63593</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">Store the new stinkbomb bits in <span class="register">C</span> briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63594"></a>63594</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the inventory flags in <span class="register">A</span> again</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63595"></a>63595</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="1">Discard the old stinkbomb bits</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63597"></a>63597</td>
<td class="instruction">OR C</td>
<td class="comment-11" rowspan="1">Superimpose the new stinkbomb bits</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63598"></a>63598</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Restore the inventory flags, minus one stinkbomb</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63599"></a>63599</td>
<td class="instruction">CALL <a class="link" href="31746.html">31746</a></td>
<td class="comment-11" rowspan="1">Print the inventory</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63602"></a>63602</td>
<td class="instruction">CALL <a class="link" href="57910.html">57910</a></td>
<td class="comment-11" rowspan="1">Prepare buffer 213 for the stinkbomb cloud (or return to the main loop if the buffer is already in use by a stinkbomb cloud)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63605"></a>63605</td>
<td class="instruction">LD L,0</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of ERIC's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63607"></a>63607</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=ERIC's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63608"></a>63608</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63609"></a>63609</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="4">Set <span class="register">A</span> to -1 if ERIC is facing left, 1 if he's facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63610"></a>63610</td>
<td class="instruction">SBC A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63611"></a>63611</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63612"></a>63612</td>
<td class="instruction">CPL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63613"></a>63613</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-11" rowspan="1">Add ERIC's x-coordinate to get the x-coordinate for the stinkbomb cloud</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63614"></a>63614</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">Copy this to <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63615"></a>63615</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63616"></a>63616</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=ERIC's y-coordinate, which will also be the y-coordinate for the stinkbomb cloud</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63617"></a>63617</td>
<td class="instruction">LD HL,54547</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 19 of the stinkbomb cloud's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63620"></a>63620</td>
<td class="instruction">LD (HL),29</td>
<td class="comment-11" rowspan="1">Initialise the counter that determines when the cloud will disappear</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63622"></a>63622</td>
<td class="instruction">LD A,71</td>
<td class="comment-11" rowspan="1"><a class="link" href="../graphics/as.html#71">71</a>: stinkbomb cloud (phase 1)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63624"></a>63624</td>
<td class="instruction">CALL <a class="link" href="30534.html">30534</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the stinkbomb cloud's appearance and place address <a class="link" href="63586.html#63627">63627</a> (below) into bytes 17 and 18 of the cloud's buffer</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63627"></a>
<div class="comments">
<div class="paragraph">
The address of the entry point below is placed into bytes 17 and 18 of the cloud's buffer by the instruction above.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63627"></a>63627</td>
<td class="instruction">LD L,19</td>
<td class="comment-11" rowspan="1">Byte 19 of the cloud's buffer holds the counter that determines how much longer the cloud will stick around (which starts off at 29)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63629"></a>63629</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Is it time for the cloud to disappear?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63630"></a>63630</td>
<td class="instruction">JP Z,<a class="link" href="29896.html#29903">29903</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63633"></a>63633</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up the counter's value in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63634"></a>63634</td>
<td class="instruction">CP 28</td>
<td class="comment-11" rowspan="1">Is it time for a teacher to give lines?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63636"></a>63636</td>
<td class="instruction">JR NZ,63646</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63638"></a>63638</td>
<td class="instruction">LD A,1</td>
<td class="comment-11" rowspan="1">Message <a class="link" href="64564.html">1</a>: NO STINKBOMBS</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63640"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a class="link" href="24175.html">24175</a>, <a class="link" href="24263.html">24263</a>, <a class="link" href="24296.html">24296</a> and <a class="link" href="63915.html">63915</a> with <span class="register">A</span> holding a reprimand message number.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63640"></a>63640</td>
<td class="instruction">SUB 62</td>
<td class="comment-11" rowspan="1">Subtract 62 now (it's added back later on)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63642"></a>63642</td>
<td class="instruction">CP A</td>
<td class="comment-11" rowspan="1">Set the zero flag to indicate that any teacher may give ERIC lines (including the one who last gave him lines)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63643"></a>63643</td>
<td class="instruction">JP <a class="link" href="32062.html#32282">32282</a></td>
<td class="comment-11" rowspan="1">Make any teacher within range give ERIC lines</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63646"></a>
<div class="comments">
<div class="paragraph">
Now deal with animating the stinkbomb cloud and checking whether it's near a window.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63646"></a>63646</td>
<td class="instruction">CALL <a class="link" href="25581.html#25648">25648</a></td>
<td class="comment-11" rowspan="1">Toggle between cloud animation phases 1 (<a class="link" href="../graphics/as.html#71">71</a>) and 2 (<a class="link" href="../graphics/as.html#199">199</a>) and update the SRB accordingly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63649"></a>63649</td>
<td class="instruction">LD L,0</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of the cloud's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63651"></a>63651</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-11" rowspan="2">Bit 0 of the cloud's animatory state (<a class="link" href="../graphics/as.html#71">71 or 199</a>) is always set, so this RET never happens</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63653"></a>63653</td>
<td class="instruction">RET Z</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63654"></a>63654</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63655"></a>63655</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=stinkbomb cloud's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63656"></a>63656</td>
<td class="instruction">CP 84</td>
<td class="comment-11" rowspan="1">The head's right study door is at x-coordinate 84</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63658"></a>63658</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if the cloud is to the left of this</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63659"></a>63659</td>
<td class="instruction">CP 96</td>
<td class="comment-11" rowspan="1">The boys' skool door is at x-coordinate 96</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63661"></a>63661</td>
<td class="instruction">RET NC</td>
<td class="comment-11" rowspan="1">Return if the cloud is to the right of this</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63662"></a>63662</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63663"></a>63663</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=stinkbomb cloud's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63664"></a>63664</td>
<td class="instruction">CP 17</td>
<td class="comment-11" rowspan="1">Is the cloud on the bottom floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63666"></a>63666</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63667"></a>
<div class="comments">
<div class="paragraph">
The stinkbomb cloud is on the top floor or middle floor, somewhere between the head's right study door and the boys' skool door. Check the windows.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63667"></a>63667</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at byte 2 of the cloud's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63668"></a>63668</td>
<td class="instruction">LD HL,32756</td>
<td class="comment-11" rowspan="1"><a class="link" href="32756.html">32756</a> holds the door/window status flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63671"></a>63671</td>
<td class="instruction">CP 3</td>
<td class="comment-11" rowspan="1">Is the cloud on the top floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63673"></a>63673</td>
<td class="instruction">JR Z,63683</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63675"></a>63675</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Is the middle-floor window already open?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63677"></a>63677</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63678"></a>63678</td>
<td class="instruction">LD BC,32861</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=128 (middle floor window), <span class="register">C</span>=93 (x-coordinate)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63681"></a>63681</td>
<td class="instruction">JR 63689</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63683"></a>63683</td>
<td class="instruction">BIT 6,(HL)</td>
<td class="comment-11" rowspan="1">Is the top-floor window already open?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63685"></a>63685</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63686"></a>63686</td>
<td class="instruction">LD BC,16475</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=64 (top-floor window), <span class="register">C</span>=91 (x-coordinate)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63689"></a>
<div class="comments">
<div class="paragraph">
Now <span class="register">B</span> holds the identifier of a closed window on the same floor as the stinkbomb cloud, and <span class="register">C</span> holds its x-coordinate. Is MR WACKER in the vicinity?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63689"></a>63689</td>
<td class="instruction">LD HL,51202</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 2 of MR WACKER's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63692"></a>63692</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is MR WACKER on the same floor as the stinkbomb cloud?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63693"></a>63693</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63694"></a>63694</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63695"></a>63695</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63696"></a>63696</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x-coordinate of the stinkbomb cloud</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63697"></a>63697</td>
<td class="instruction">SUB 3</td>
<td class="comment-11" rowspan="3">Return if MR WACKER is more than 2 spaces to the left of the cloud</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63699"></a>63699</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63700"></a>63700</td>
<td class="instruction">RET NC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63701"></a>63701</td>
<td class="instruction">ADD A,5</td>
<td class="comment-11" rowspan="3">Return if MR WACKER is more than 2 spaces to the right of the cloud</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63703"></a>63703</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63704"></a>63704</td>
<td class="instruction">RET C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63705"></a>
<div class="comments">
<div class="paragraph">
MR WACKER is close enough to the stinkbomb cloud to be affected by its stench. Check whether he's available for a spot of window-opening.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63705"></a>63705</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=MR WACKER's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63706"></a>63706</td>
<td class="instruction">LD L,18</td>
<td class="comment-11" rowspan="3">Is there an uninterruptible subcommand routine address in bytes 17 and 18 of MR WACKER's buffer (meaning he is otherwise occupied at the moment)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63708"></a>63708</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63709"></a>63709</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63710"></a>63710</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63711"></a>63711</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63712"></a>63712</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=MR WACKER's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63713"></a>63713</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1">Is MR WACKER midstride?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63714"></a>63714</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63715"></a>63715</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=MR WACKER's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63716"></a>63716</td>
<td class="instruction">LD L,19</td>
<td class="comment-11" rowspan="4">Store MR WACKER's current x-coordinate and animatory state in bytes 19 and 20 of his buffer for later retrieval</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63718"></a>63718</td>
<td class="instruction">LD (HL),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63719"></a>63719</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63720"></a>63720</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63721"></a>63721</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">Store the x-coordinate of the window in byte 21</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63722"></a>63722</td>
<td class="instruction">LD (HL),C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63723"></a>63723</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">Byte 22 holds 128 (middle-floor window) or 64 (top-floor window)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63724"></a>63724</td>
<td class="instruction">LD (HL),B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63725"></a>63725</td>
<td class="instruction">CALL <a class="link" href="25012.html">25012</a></td>
<td class="comment-11" rowspan="1">Update the SRB for MR WACKER's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63728"></a>63728</td>
<td class="instruction">SET 7,A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=animatory state of MR WACKER facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63730"></a>63730</td>
<td class="instruction">CALL <a class="link" href="30534.html">30534</a></td>
<td class="comment-11" rowspan="1">Place address <a class="link" href="63586.html#63733">63733</a> (below) into bytes 17 and 18 of MR WACKER's buffer and update his animatory state</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63733"></a>
<div class="comments">
<div class="paragraph">
The address of the entry point below is placed into bytes 17 and 18 of MR WACKER's buffer by the instruction above.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63733"></a>63733</td>
<td class="instruction">LD L,0</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of MR WACKER's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63735"></a>63735</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-11" rowspan="1">Is MR WACKER midstride?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63737"></a>63737</td>
<td class="instruction">JP NZ,<a class="link" href="25581.html#25597">25597</a></td>
<td class="comment-11" rowspan="1">Finish his stride if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63740"></a>63740</td>
<td class="instruction">JP <a class="link" href="63801.html">63801</a></td>
<td class="comment-11" rowspan="1">Otherwise set MR WACKER off on his journey to the window</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="63576.html">63576</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#63586">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="63743.html">63743</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Back to Skool RAM disassembly 20150415</div>
<div class="copyright">&#169; 1985 Microsphere Computer Services Ltd (Back to Skool). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>